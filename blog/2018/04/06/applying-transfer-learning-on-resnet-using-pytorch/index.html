<!DOCTYPE html>
<html lang="en-us">
  <head>
    <title>Applying Transfer Learning on ResNet using PyTorch - Gnanesh Kunal</title>
    <meta charset="utf-8" />
    <meta name="author" content="Gnanesh Kunal" />
    <meta name="description" content="Transfer Learning on a ResNet structure." />
    <meta name="keywords" content="Machine Learning, PyTorch" />
    <link rel="stylesheet" href="/media/css/main.css" type="text/css">
    <link rel="stylesheet" href="/media/css/prettify.css" type="text/css">
  </head>
  <body class="container">
    <div>
      <header class="masthead">
        <h1 class="masthead-title"><a href="/">Gnanesh Kunal</a></h1>
        <p>y² mod p = ⟮x³ +7⟯ mod p</p>
        <ul>
          <li><a href="/blog/">Blog</a></li>
          <li><a href="/tags/">Tags</a></li>
	  <!--
          <li><a href="/tags/">Tags</a></li>
	  -->
          <li><a href="/about/">About</a></li>
          <li><a href="https://github.com/gnaneshkunal">GitHub</a></li>
	  <li><a href="https://www.dropbox.com/s/jx879x3nt299ol8/resumegk.pdf?raw=1">Resume</a></li>
	  <li><a href="http://amzn.in/j8KlRjG">Amazon-books</a></li>
          <li><a href="/rss.xml">RSS</a></li>
        </ul>
	<!--
        <form method="get" id="searchform" action="//www.google.com/search">
          <input type="text" class="field" name="q" id="s" placeholder="Search">
          <input type="hidden" name="as_sitesearch" value="gnaneshkunal.com">
        </form>
	-->
      </header>
    </div>

<div>
<div class="post">
<h1>Applying Transfer Learning on ResNet using PyTorch</h1>
<p>
Recently I've written a Classifier that is able to distinguish dogs from
cats.
</p>

<p>
Things I've learned: 
</p>
<ul class="org-ul">
<li>How to use a Pretrained Model</li>
<li>Apply Transfer Learning</li>
</ul>

<div id="outline-container-orgc737227" class="outline-2">
<h2 id="dataset"><a id="orgc737227"></a>DATASET</h2>
<div class="outline-text-2" id="text-dataset">
<p>
I've trained the model using Kaggle's classic dogs vs. cats dataset. The
dataset can be found
<a href="https://www.kaggle.com/c/dogs-vs-cats/data">here</a>
</p>

<p>
Well, I have to say it's not plug and play. At least not for the
<code>torchvision</code> APIs. <code>torchvision</code> has an <code>ImageFolder</code> that's (right
now) the standard to load images as well as it's labels automatically.
The document suggests that <code>ImageFolder</code> requires the dataset in the
following format:
</p>

<div class="org-src-container">
<pre class="src src-sh">root/dog/xxx.png
root/dog/xxy.png
root/dog/xxz.png

root/cat/123.png
root/cat/nsdf3.png
root/cat/asd932_.png
</pre>
</div>

<p>
So, I've arranged the dataset as the <code>ImageFolder</code> requires me to.
</p>
</div>
</div>

<div id="outline-container-org76e4e11" class="outline-2">
<h2 id="model"><a id="org76e4e11"></a>Model</h2>
<div class="outline-text-2" id="text-model">
<p>
The choice is arbitrary. I've considered some wired model. I don't know
what to name it.
</p>

<div class="org-src-container">
<pre class="src src-python">self.conv1 = nn.Conv2d(3, 8, 5)
self.pool = nn.MaxPool(2, 2)
self.conv2 = nn.Conv2d(8, 16, 3)
self.conv3 = nn.Conv2d(16, 32, 3)
self.conv4 = nn.Conv2d(32, 64, 3)
self.conv5 = nn.Conv2d(64, 64, 3)

self.fc1 = nn.Linear(64 * 5 * 5, 1000)
self.fc2 = nn.Linear(1000, 500)
self.fc3 = nn.Linear(500, 120)
self.fc4 = nn.Linear(120, 84)
self.fc5 = nn.Linear(84, 10)
self.fc6 = nn.Linear(10, 2)
</pre>
</div>

<p>
With ReLu everywhere and softmax layer at the end. It worked but not as
I thought its gonna be. And its still smaller than starter ResNet which
is ResNet18. So, I've considered ResNet18 over my network.
</p>
</div>
</div>

<div id="outline-container-orgffedc68" class="outline-2">
<h2 id="training"><a id="orgffedc68"></a>Training</h2>
<div class="outline-text-2" id="text-training">
<p>
I've considered training my ResNet18 for the whole dataset. But the main
problem is I don't have a GPU. (ノಠ益ಠ)ノ彡┻━┻
</p>

<p>
So <b>Transfer Learning</b> is the only choice I've got. I've opted for a
pretrained Model which is trained on an ImageNet.
</p>


<p>
Choices I've got: 
</p>
<ul class="org-ul">
<li>Full Pretrained Model</li>
<li>Fine-Tuning the ConvNet</li>
<li>ConvNet as fixed feature extractor</li>
</ul>
</div>

<div id="outline-container-orgeef2a8f" class="outline-3">
<h3 id="full-pretrained-model"><a id="orgeef2a8f"></a>Full Pretrained Model</h3>
<div class="outline-text-3" id="text-full-pretrained-model">
<p>
I've got to tell you that using this is of no use. It just works. You
don't have to do anything. You just have to write the predict function.
</p>
</div>
</div>

<div id="outline-container-orgb2f2a81" class="outline-3">
<h3 id="fine-tuning-the-convnet"><a id="orgb2f2a81"></a>Fine-Tuning the ConvNet</h3>
<div class="outline-text-3" id="text-fine-tuning-the-convnet">
<p>
Taking the whole network and retraining the parameters just looked cool
and painful too. Well, this one worked really good. The results were
good too. It took so much time to train the model than I've thought it
would take. I've trained the model but forgot to save it. I trained it
another time though. But the time consumption was really too much.
</p>
</div>
</div>

<div id="outline-container-org3a5061c" class="outline-3">
<h3 id="convnet-as-fixed-feature-extractor"><a id="org3a5061c"></a>ConvNet as fixed feature extractor</h3>
<div class="outline-text-3" id="text-convnet-as-fixed-feature-extractor">
<p>
Taking the whole network and adding a final layer and training just
the last layer with softmax has done the job. The results are as
expected. And also, It takes too less time compared to Full training
and Fine-Tuning the ConvNet. The results are almost equal to the
Fine-Tuning technique.
</p>
</div>
</div>
</div>

<div id="outline-container-org0134953" class="outline-2">
<h2 id="org0134953">Predictions</h2>
<div class="outline-text-2" id="text-org0134953">
<p>
I've got more than 91% of accuracy.
</p>


<div class="figure">
<p><img src="/assets/blog/2018/04/06/applying-transfer-learning-on-resnet-using-pytorch/cnn1.png" alt="cnn1.png" />
</p>
</div>


<p>
I've tried some dog filter on <a href="https://twitter.com/praneshbalu7">praveen</a> just to check whether it is able
to classify him correctly. Well, it has classified him as a <code>cat</code>
though. Look likes there's even more to do. ┬──┬ ノ( ゜-゜ノ)
</p>


<div class="figure">
<p><img src="/assets/blog/2018/04/06/applying-transfer-learning-on-resnet-using-pytorch/cnn2.png" alt="cnn2.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-orgeb10059" class="outline-2">
<h2 id="orgeb10059">Source Code</h2>
<div class="outline-text-2" id="text-orgeb10059">
<p>
<a href="https://github.com/GnaneshKunal/dogs-vs-cats-classifier/">GnaneshKunal/dogs-vs-cats-classifier</a>
</p>
</div>
</div>

<div id="outline-container-orgc824738" class="outline-2">
<h2 id="orgc824738">Useful Links</h2>
<div class="outline-text-2" id="text-orgc824738">
<ul class="org-ul">
<li><a href="https://cs231n.github.io/transfer-learning/">Transfer Learning</a></li>
<li><a href="https://arxiv.org/pdf/1512.03385.pdf">Resnet</a></li>
<li><a href="https://arxiv.org/pdf/1311.2901.pdf">Visualizing and Understanding Convolutional Networks</a></li>
<li><a href="http://pytorch.org/docs/0.3.1/">PyTorch</a></li>
</ul>
</div>
</div>

</div>
</div>
    <div>
      <div class="post-meta">
        <span title="post date" class="post-info">2018-04-06</span>
        <span title="last modification date" class="post-info">2018-09-09</span>
        <span title="tags" class="post-info"><a href="/tags/machine-learning/">Machine Learning</a>, <a href="/tags/pytorch/">PyTorch</a></span>
        <span title="author" class="post-info">Gnanesh Kunal</span>
      </div>
      <section>
        <h1>Comments</h1>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
          //var disqus_developer = 1;
          var disqus_identifier = "/blog/2018/04/06/applying-transfer-learning-on-resnet-using-pytorch";
          var disqus_url = "https://gnaneshkunal.com/blog/2018/04/06/applying-transfer-learning-on-resnet-using-pytorch";
          var disqus_shortname = 'gnanesh';
          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="//disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        <div class="ds-thread"></div>
        <script type="text/javascript">
          var duoshuoQuery = {short_name:'duoshuo'};
          (function() {
          var ds = document.createElement('script');
          ds.type = 'text/javascript';ds.async = true;
          ds.src = 'http://static.duoshuo.com/embed.js';
          ds.charset = 'UTF-8';
          (document.getElementsByTagName('head')[0]
          || document.getElementsByTagName('body')[0]).appendChild(ds);
          })();
        </script>
       <div id="hashover"></div>
       <script type="text/javascript" src="/hashover.php"></script>
       <noscript>You must have JavaScript enabled to use the comments.</noscript>
      </section>
      <script src="//code.jquery.com/jquery-latest.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.js"></script>
      <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script src="/media/js/main.js"></script>
      <div class="footer">
        <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 26.x (<a href="http://orgmode.org">Org mode</a> 9.x)</p>
        <p>
          Copyright &copy; 2012 - <span id="footerYear"></span> <a href="mailto:gnaneshkunal &lt;at&gt; outlook &lt;dot&gt; com">Gnanesh Kunal</a>
          &nbsp;&nbsp;-&nbsp;&nbsp;
          Powered by <a href="https://github.com/kelvinh/org-page" target="_blank">org-page</a>
          <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
        </p>
      </div>
    </div>

  </body>
</html>
