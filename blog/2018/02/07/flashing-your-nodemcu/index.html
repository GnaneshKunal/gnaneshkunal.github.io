<!DOCTYPE html>
<html lang="en-us">
  <head>
    <title>Flashing your NodeMCU - Gnanesh Kunal</title>
    <meta charset="utf-8" />
    <meta name="author" content="Gnanesh Kunal" />
    <meta name="description" content="Description on Flashing NodeMCU." />
    <meta name="keywords" content="IoT, NodeMCU" />
    <link rel="stylesheet" href="/media/css/main.css" type="text/css">
    <link rel="stylesheet" href="/media/css/prettify.css" type="text/css">
  </head>
  <body class="container">
    <div>
      <header class="masthead">
        <h1 class="masthead-title"><a href="/">Gnanesh Kunal</a></h1>
        <p>y² mod p = ⟮x³ +7⟯ mod p</p>
        <ul>
          <li><a href="/blog/">Blog</a></li>
          <li><a href="/tags/">Tags</a></li>
	  <!--
          <li><a href="/tags/">Tags</a></li>
	  -->
          <li><a href="/about/">About</a></li>
          <li><a href="https://github.com/gnaneshkunal">GitHub</a></li>
	  <li><a href="https://www.dropbox.com/s/jx879x3nt299ol8/resumegk.pdf?raw=1">Resume</a></li>
	  <li><a href="http://amzn.in/j8KlRjG">Amazon-books</a></li>
          <li><a href="/rss.xml">RSS</a></li>
        </ul>
	<!--
        <form method="get" id="searchform" action="//www.google.com/search">
          <input type="text" class="field" name="q" id="s" placeholder="Search">
          <input type="hidden" name="as_sitesearch" value="gnaneshkunal.com">
        </form>
	-->
      </header>
    </div>

<div>
<div class="post">
<h1>Flashing your NodeMCU</h1>
<p>
NodeMCU always comes to my mind (just like Arduino) while I think about
any project related to the Internet of Things. I know, Arduino is a way
better than NodeMCU. Lots of libraries, portability, and you can plug to
almost all anything.
</p>

<p>
<i>Anything</i>?
</p>

<p>
<i>Yes, Anything!!</i>
</p>


<p>
Well, the only reason I prefer NodeMCU over Arduino UNO is the inbuilt
WIFI module (ESP8266) NodeMCU comes with.
</p>


<div class="figure">
<p><img src="/assets/blog/2018/02/07/flashing-your-nodemcu/node-mcu.png" alt="node-mcu.png" />
</p>
</div>

<p>
The ESP8266 is also available as a standalone WIFI module, which you can
connect to most of the Microcontrollers. But most of the
Microcontrollers use 5v as default compared to 3.3v of ESP9266.
</p>

<p>
Arduino UNO isn't compatible due to its 5v only outputs. There's a 3.3v
output though, but the current generated from that isn't enough for the
ESP8266 module.
</p>

<p>
So, then you can use the standard 5v output and regulate the current
using a Voltage Regulator that converts the 5v to 3.3v. This also
assures that enough current will be provided from the output.
</p>

<p>
You can use the Voltage Regulator(AMS1117) which converts 5v to 3.3v. If
you don't have a Voltage Regulator, you can use a Potentiometer. Using a
potentiometer is a bit harmful that it could damage if there's any rise
in voltage.
</p>

<p>
There's a lot of things to do even after you have done your wiring.
</p>

<p>
This could be said for a reason that I simply prefer NodeMCU over
Arduino + ESP8266.
</p>

<p>
<i>Why don't you simply pick NodeMCU over Arduino + ESP8266 which
ignores all the problems requirements mentioned above?</i>
</p>

<p>
Well even in NodeMCU you must do some simple(software side) steps that
are most often confused.
</p>

<p>
Steps that you must do: 0. Update your Firmware 1. Verify your Firmware
</p>
<ol class="org-ol">
<li>Test with a small Program</li>
</ol>

<div id="outline-container-orgb027528" class="outline-2">
<h2 id="update-your-firmware"><a id="orgb027528"></a>UPDATE YOUR FIRMWARE</h2>
<div class="outline-text-2" id="text-update-your-firmware">
<ol class="org-ol">
<li><p>
Download esptool either as a zip file or using git clone.
</p>

<div class="org-src-container">
<pre class="src src-sh">git clone https://github.com/themadinventor/esptool.git
</pre>
</div></li>

<li>Connect the NodeMCU via USB cable to the computer.</li>

<li><p>
Make sure you have python2.7 installed, open a terminal and type
</p>

<div class="org-src-container">
<pre class="src src-sh">sudo python setup.py install
</pre>
</div></li>

<li>Download the latest NodeMCU firmware from <a href="https://github.com/nodemcu/nodemcu-firmware/releases">here</a>. You could find
nodemcu\_integer\_*.bin at the end of the page.</li>

<li><p>
Flash the firmware using the following command.
</p>

<div class="org-src-container">
<pre class="src src-sh">sudo python2 esptool.py --baud 460800 --port /dev/ttyUSB0 write_flash
-fm dio 0x00000
/home/monster/Downloads/nodemcu_integer_0.9.6-dev_20150704.bin
</pre>
</div>

<p>
If that worked, you are good to go
</p>

<div class="org-src-container">
<pre class="src src-sh">[monster@monster esptool]$ sudo python2 esptool.py --baud 460800 --port /dev/ttyUSB0 write_flash -fm dio 0x00000 /home/monster/Downloads/nodemcu_integer_0.9.6-dev_20150704.bin
esptool.py v2.3-dev
Connecting....
Detecting chip type... ESP8266
Chip is ESP8266EX
Uploading stub...
Running stub...
Stub running...
Changing baud rate to 460800
Changed.
Configuring flash size...
Auto-detected Flash size: 4MB
Flash params set to 0x0240
Compressed 450072 bytes to 290528...
Wrote 450072 bytes (290528 compressed) at 0x00000000 in 6.6 seconds (effective 543.0 kbit/s)...
Hash of data verified.
Leaving...
Hard resetting via RTS pin...
[monster@monster esptool]$ 
</pre>
</div></li>
</ol>
</div>
</div>

<div id="outline-container-orgf3e2a27" class="outline-2">
<h2 id="verify-your-firmware"><a id="orgf3e2a27"></a>VERIFY YOUR FIRMWARE</h2>
<div class="outline-text-2" id="text-verify-your-firmware">
<ol class="org-ol">
<li>Install the CP2102 driver from
<a href="https://www.silabs.com/products/development-tools/software/usb-to-uart-bridge-vcp-drivers">here</a>.</li>
<li><p>
Then extract the tarball and run the makefile
</p>

<div class="org-src-container">
<pre class="src src-sh">[monster@monster ~]$ tar xvzf '/home/monster/Linux_3.x.x_4.x.x_VCP_Driver_Source.tar.gz'
[monster@monster ~]$ cd Linu*Source
[monster@monster Linux_3.x.x_4.x.x_VCP_Driver_Source]$ make
make -C /lib/modules/`uname -r`/build M=/home/monster/Linux_3.x.x_4.x.x_VCP_Driver_Source modules
make[1]: Entering directory '/usr/src/kernels/4.14.16-300.fc27.x86_64'
  Building modules, stage 2.
  MODPOST 1 modules
make[1]: Leaving directory '/usr/src/kernels/4.14.16-300.fc27.x86_64'
[monster@monster Linux_3.x.x_4.x.x_VCP_Driver_Source]$
</pre>
</div></li>

<li><p>
Additional Configurations
</p>

<div class="org-src-container">
<pre class="src src-sh">[monster@monster ~]$ modprobe cp210x
[monster@monster ~]$ export DISPLAY=:0
[monster@monster ~]$ xhost + localhost
[monster@monster ~]$ export DISPLAY=":0.0"
[monster@monster ~]$ xhost +local:all
[monster@monster ~]$ xhost +inet:&lt;your_ip_address&gt;
</pre>
</div></li>

<li>Download ESPlorer from
<a href="http://esp8266.ru/esplorer-latest/?f=ESPlorer.zip">here</a>.</li>

<li><p>
Run the ESPlorer using the following command.
</p>

<div class="org-src-container">
<pre class="src src-sh">[monster@monster ~]$ cd ESPlorer
[monster@monster ~]$ sudo java -jar ESPlorer.jar
</pre>
</div></li>

<li>This the window you'll be getting</li>
</ol>


<div class="figure">
<p><img src="/assets/blog/2018/02/07/flashing-your-nodemcu/node-mcu1.png" alt="node-mcu1.png" />
</p>
</div>

<ol class="org-ol">
<li>Select the /dev/tty*(your USB NO., Mine is /dev/ttyUSB0) and set the
baud rate to 9600. Then click the "Open" button in ESPlorer
Configuration.</li>

<li>Push the RST button on the ESP8266(two times), it is right next to
the micro-USB port.</li>
<li>You should now see a message</li>
</ol>


<div class="figure">
<p><img src="/assets/blog/2018/02/07/flashing-your-nodemcu/node-mcu2.png" alt="node-mcu2.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-org69528cf" class="outline-2">
<h2 id="final-program"><a id="org69528cf"></a>FINAL PROGRAM</h2>
<div class="outline-text-2" id="text-final-program">
</div>
</div>

<div id="outline-container-org2e119be" class="outline-2">
<h2 id="org2e119be">NodeMCU uses Lua programming language, which is a cross breed of</h2>
<div class="outline-text-2" id="text-org2e119be">
<p>
Node.js and python. When booting the device will look for a file called
init.lua and executes the file.
</p>
<p>
:CUSTOM_ID: nodemcu-uses-lua-programming-language-which-is-a-cross-breed-of-node.js-and-python.-when-booting-the-device-will-look-for-a-file-called-init.lua-and-executes-the-file.
</p>

<ol class="org-ol">
<li>Click the Format button to delete all the files.</li>

<li><p>
Copy/paste the following code
</p>

<pre class="example">
-- Config
local pin = 4            --&gt; GPIO2
local value = gpio.LOW
local duration = 1000    --&gt; 1 second
-- Function toggles LED state
function toggleLED ()
if value == gpio.LOW then
    value = gpio.HIGH
else
    value = gpio.LOW
end

gpio.write(pin, value)
end
-- Initialise the pin
gpio.mode(pin, gpio.OUTPUT)
gpio.write(pin, value)
-- Create an interval
tmr.alarm(0, duration, 1, toggleLED)
</pre></li>

<li>Save the file as <code>init.lua</code>.</li>
</ol>


<div class="figure">
<p><img src="/assets/blog/2018/02/07/flashing-your-nodemcu/node-mcu3.png" alt="node-mcu3.png" />
</p>
</div>

<ol class="org-ol">
<li>Now the blue onboard LED should blink on and off every second. If you
restart the device, it will load the init.lua file and keep on
blinking.</li>
</ol>


<div class="figure">
<p><img src="/assets/blog/2018/02/07/flashing-your-nodemcu/node-mcu4.png" alt="node-mcu4.png" />
</p>
</div>

<ol class="org-ol">
<li>If the LED doesn't blink, then you can do normal <code>upload</code>,
<code>"Save to ESP"</code>, <code>"Send to ESP"</code> and click <code>Run</code>.</li>
</ol>
</div>
</div>

</div>
</div>
    <div>
      <div class="post-meta">
        <span title="post date" class="post-info">2018-02-07</span>
        <span title="last modification date" class="post-info">2018-09-09</span>
        <span title="tags" class="post-info"><a href="/tags/iot/">IoT</a>, <a href="/tags/nodemcu/">NodeMCU</a></span>
        <span title="author" class="post-info">Gnanesh Kunal</span>
      </div>
      <section>
        <h1>Comments</h1>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
          //var disqus_developer = 1;
          var disqus_identifier = "/blog/2018/02/07/flashing-your-nodemcu";
          var disqus_url = "https://gnaneshkunal.com/blog/2018/02/07/flashing-your-nodemcu";
          var disqus_shortname = 'gnanesh';
          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="//disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        <div class="ds-thread"></div>
        <script type="text/javascript">
          var duoshuoQuery = {short_name:'duoshuo'};
          (function() {
          var ds = document.createElement('script');
          ds.type = 'text/javascript';ds.async = true;
          ds.src = 'http://static.duoshuo.com/embed.js';
          ds.charset = 'UTF-8';
          (document.getElementsByTagName('head')[0]
          || document.getElementsByTagName('body')[0]).appendChild(ds);
          })();
        </script>
       <div id="hashover"></div>
       <script type="text/javascript" src="/hashover.php"></script>
       <noscript>You must have JavaScript enabled to use the comments.</noscript>
      </section>
      <script src="//code.jquery.com/jquery-latest.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.js"></script>
      <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script src="/media/js/main.js"></script>
      <div class="footer">
        <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 26.x (<a href="http://orgmode.org">Org mode</a> 9.x)</p>
        <p>
          Copyright &copy; 2012 - <span id="footerYear"></span> <a href="mailto:gnaneshkunal &lt;at&gt; outlook &lt;dot&gt; com">Gnanesh Kunal</a>
          &nbsp;&nbsp;-&nbsp;&nbsp;
          Powered by <a href="https://github.com/kelvinh/org-page" target="_blank">org-page</a>
          <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
        </p>
      </div>
    </div>

  </body>
</html>
